<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200..900&display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Train+One&display=swap" rel="stylesheet">
        <title>Document</title>
        <style>
            * {
                margin: 0px;
                padding: 0px;
                box-sizing: border-box;
            }

            #allrecords a {
                text-decoration: none;
                color: white;
            }

            #allrecords ul {
                list-style: none;
                padding-left: 0px;
                padding: 0px;
            }

            /* font 1 */
            @font-face {
                font-family: 'Comic Code Ligatures Light Italic';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/1.1Comic%20Code%20Ligatures%20Light%20Italic.otf') format('opentype');
            }
            /* font 2 */
            @font-face {
                font-family: 'Arsinova Deco';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/10.1Arsinova%20Deco.ttf') format('truetype');
            }
            /* font 3 */
            @font-face {
                font-family: 'ACLine';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/2.1ACLine.ttf') format('truetype');
            }

            /* font 4 */
            @font-face {
                font-family: 'UniSans-Trial-Thin';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/2.2UniSans-Trial-Thin.otf') format('opentype');
            }

            /* font 5 */
            @font-face {
                font-family: 'Gilroy-Light';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/3.1Gilroy-Light.otf') format('opentype');
            }
            /* font 6 */
            @font-face {
                font-family: 'bauhaus';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/3.2bauhaus.ttf') format('truetype');
            }
            
            /* font 7 */
            @font-face {
                font-family: 'Uni Sans Thin Italic';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/4.1Uni%20Sans%20Thin%20Italic.otf') format('opentype');
            }
            /* font 8 */
            @font-face {
                font-family: 'Aqum 2 Classic';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/5.1Aqum%202%20Classic.otf') format('opentype');
            }
            /* font 9 */
            @font-face {
                font-family: '_Myriad Pro';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/5.2_Myriad%20Pro.ttf') format('truetype');
            }
            /* font 10 */
            @font-face {
                font-family: 'Bitter-Thin';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/6.1Bitter-Thin.ttf') format('truetype');
            }
            /* font 11 */
            @font-face {
                font-family: 'bimbo-ballpoint';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/7.1bimbo-ballpoint.ttf') format('truetype');
            }
            /* font 12 */
            @font-face {
                font-family: 'segoe-script';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/7.2segoe-script.ttf') format('truetype');
            }
            /* font 13 */
            @font-face {
                font-family: 'Diamondgirl';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/7.3Diamondgirl.otf') format('opentype');
            }
            /* font 14 */
            @font-face {
                font-family: 'mr_vlashu';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/8.1mr_vlashu.otf') format('opentype');
            }
            /* font 15 */
            @font-face {
                font-family: 'gogoia-deco';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/9.1gogoia-deco.ttf') format('truetype');
            }
            /* font 16 */
            @font-face {
                font-family: 'slimamif';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/9.2slimamif.ttf') format('truetype');
            }
            /* font 17 */
            @font-face {
                font-family: 'Vasek Italic_0';
                src: url('https://anlapaev.github.io/fonts/fonts-neonroomnn/fonts/ru/9.3Vasek%20Italic_0.ttf') format('truetype');
            }

            /* font 18 */
            @font-face {
                font-family: 'Repivmanusc-bold';
                src: url('https://anlapaev.github.io/fonts/Repivmanusc%20Bold/Repivmanusc%20Bold.ttf') format('truetype');
            }

            /* font 19 */
            @font-face {
                font-family: 'Repivmanusc';
                src: url('https://anlapaev.github.io/fonts/Repivmanusc%20Bold/Repivmanusc.ttf') format('truetype');
            }

            /* font 20 */
            @font-face {
                font-family: 'Nickainley-Normal';
                src: url('https://anlapaev.github.io/fonts/Nickainley/Nickainley-Normal.otf') format('opentype');
            }

            /* font 21 */
            @font-face {
                font-family: 'Nickainley-normal';
                src: url('https://anlapaev.github.io/fonts/Nickainley/nickainley_normal.otf') format('opentype');
            }

            /* font 22 */
            @font-face {
                font-family: 'Monoton-Regular';
                src: url('https://anlapaev.github.io/fonts/Monoton/Monoton-Regular.ttf') format('truetype');
            }

            /* font 23 */
            @font-face {
                font-family: 'Havana';
                src: url('https://anlapaev.github.io/fonts/Havana%20Rus/19_Havana.ttf') format('truetype');
            }

            /* font 24 */
            @font-face {
                font-family: 'Hastron';
                src: url('https://anlapaev.github.io/fonts/hastron/Hastron/Hastron_FREE.ttf') format('truetype');
            }

            /* font 25 */
            @font-face {
                font-family: 'Pecita';
                src: url('https://anlapaev.github.io/fonts/pecita/Pecita.otf') format('opentype');
            }

            .container {
                max-width: 1200px;
                height: 100%;
                padding: 10px;
                margin: auto auto;
            }
            .wrapper {
                display: grid;
                grid-template-columns: 360px 1fr;
                column-gap: 20px;
                grid-template-areas: "left right";
            }

            .left-block {
                grid-area: left;
                max-width: 480px;
                height: fit-content;
                background-color: black;
                border-radius: 25px;
                padding: 23px 35px 60px 35px;
            }

            .form-block {
                display: flex;
                flex-direction: column;
                grid-gap: 15px;
            }
            
            .right-block {
                grid-area: right;
                width: 100%;
                min-height: 440px;
                border-radius: 25px;
                padding: 0 50px;
                background-size: cover;
                background-position: center;
                position: relative;
                transition: background 0.4s ease, background-image 0.4s ease;
            }

            /* Вотермарк */
            #right-block::before,
            #right-block::after {
                position: absolute;
                font-size: 12px;
                color: rgba(255, 255, 255, 0.1); 
                font-family: "Unbounded", sans-serif;
                pointer-events: none;
                user-select: none;
                z-index: 5;
                white-space: nowrap;
            }

            #right-block::before {
                content: "neonroom.nn";
                top: 10px;
                right: 12px;
            }

            #right-block::after {
                content: "neonroom.nn";
                bottom: 10px;
                left: 12px;
            }


            /* left block styles content start*/
            .title-signboard {
                font-size: 14px;
                font-family: "Unbounded";
                font-weight: 800;
                color: #fff;
                margin-bottom: 8px;
            }

            .left-block hr {
                margin-bottom: 21px;
            }

            .left-block label {
                color: #fff;
                font-family: "Unbounded";
                font-weight: 300;
                font-size: 10px;
                margin-bottom: 9px;
                display: block;
            }
            .button-preview-neon {
                display: flex;
                justify-content: center;
                align-items: center;
                text-transform: uppercase;
                border-radius: 1rem;
                transition: all .3s;
                position: relative;
                overflow: hidden;
                z-index: 1;
                width: 100%;
                height: 30px;
                background-color: #FD8701;
                border: none;
                box-shadow: 0 0 5px 2px #FD8701;
                font-family: "Unbounded";
                font-weight: 800;
                color: #fff;
                cursor:pointer;
                text-align: center;
                text-decoration: none;
                font-size: 12px;
            }
            .button-preview-neon::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #FD8701;
                border-radius: 10rem;
                z-index: -2;
            }
            .button-preview-neon::before {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 0%;
                height: 100%;
                background-color: #d86e00;
                transition: all 0.3s;
                border-radius: 10rem;
                z-index: -1;
            }
            .button-preview-neon:active {
                transform: scale(0.97);
                box-shadow: 0 0 2px 1px #FD8701;
            }

            .button-preview-neon:hover::before {
                width: 100%;
            }
            .button-form-calc {
                display: flex;
                justify-content: center;
                align-items: center;
                text-transform: uppercase;
                border-radius: 1rem;
                transition: all .3s;
                position: relative;
                overflow: hidden;
                z-index: 1;
                width: 100%;
                height: 30px;
                background-color: #FD8701;
                border: none;
                box-shadow: 0 0 5px 2px #FD8701;
                font-family: "Unbounded";
                font-weight: 800;
                color: #fff;
                cursor:pointer;
                text-align: center;
                text-decoration: none;
                font-size: 12px;
                
            }
            .button-form-calc::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #FD8701;
                border-radius: 10rem;
                z-index: -2;
            }
            .button-form-calc::before {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                width: 0%;
                height: 100%;
                background-color: #d86e00;
                transition: all 0.3s;
                border-radius: 10rem;
                z-index: -1;
            }
            .button-form-calc:active {
                transform: scale(0.97);
                box-shadow: 0 0 2px 1px #FD8701;
            }

            .button-form-calc:hover::before {
                width: 100%;
            }

            .field-signboard {
                width: 100%;
                height: 66px;
                display: flex;
                flex-direction: column;
            }

            .field-signboard textarea {
                width: 100%;
                min-height: 50px;
                border-radius: 10px;
                border: 2px solid #fff;
                color: #fff;
                
                background-color: transparent;
                transition: border-color 0.3s ease;
                text-align: left;
                line-height: 1.2;
                padding-left: 17px;
                padding-top: 14px;
                font-size: 14px;
                resize: vertical;
                overflow-y: hidden;
                white-space: pre-wrap;
                word-wrap: break-word;

            }

            .field-signboard textarea:focus {
                border-color: #FD8701; 
                outline: none; 
            }

            .custom-select-wrapper {
                position: relative;
                width: 100%;
                font-family: "Unbounded";
            }

            /* dropdown variant 1 */
            .font-dropdown {
                position: relative;
                width: 100%;
                user-select: none;
                font-family: sans-serif;
            }

            .font-dropdown__selected {
                padding: 12px 16px;
                background-color: black;
                color: white;
                border: 2px solid white;
                border-radius: 10px;
                cursor: pointer;
                position: relative;
            }

            .font-dropdown__selected:focus {
                border-color: #FD8701;
                outline: none;
            }

            .font-dropdown__arrow {
                position: absolute;
                top: 50%;
                right: 10px;
                width: 14px;
                height: 14px;
                background-image: url('https://raw.githubusercontent.com/anlapaev/fonts/885760fdc3b33793d41068b37b386ecdbaccb2c0/Vector%2019.svg');
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                transform: translateY(-50%) rotate(0deg);
                transition: transform 0.3s ease;
                pointer-events: none;
            }

            .font-dropdown.open .font-dropdown__arrow {
                transform: translateY(-50%) rotate(180deg);
            }

            .font-dropdown__list {
                position: absolute;
                top: calc(100% + 4px);
                left: 0;
                width: 100%;
                background-color: black;
                border-width: 0;
                border-top: 2px solid white;
                border-left: 2px solid white;
                border-bottom: 2px solid white;
                border-radius: 10px;
                max-height: 0;
                overflow: hidden;
                opacity: 0;
                transition: max-height 0.3s ease, opacity 0.3s ease;
                z-index: 100;
            }

            .font-dropdown__list.show {
                max-height: 150px;
                overflow-y: auto;
                list-style-type: none;
                opacity: 1;
                scrollbar-color: #FD8701 black;
                scrollbar-width: thin;
            }

            .font-dropdown__option {
                padding: 12px 16px;
                cursor: pointer;
                transition: background-color 0.2s ease;
                white-space: nowrap;
                color: #fff;
                list-style-type: none;
            }

            .font-dropdown__option:hover {
                background-color: #FD8701;
                color: #fff;
            }



            /* dropdown 2 */

            /* Обёртка */
            .dropdown-wrapper {
                position: relative;
                width: 100%;
                font-family: "Unbounded";
            }

            /* Основной контейнер селекта */
            .dropdown-wrapper[data-type="select-only"] {
                position: relative;
                width: 100%;
                user-select: none;
                font-family: sans-serif;
            }

            /* Активный выбранный элемент */
            .dropdown-selected {
                padding: 12px 16px;
                background-color: black;
                color: white;
                border: 2px solid white;
                border-radius: 10px;
                cursor: pointer;
                position: relative;
            }

            .dropdown-selected:focus {
                border-color: #FD8701;
                outline: none;
            }

            /* Стрелка */
            .dropdown-arrow {
                position: absolute;
                top: 50%;
                right: 10px;
                width: 14px;
                height: 14px;
                background-image: url('https://raw.githubusercontent.com/anlapaev/fonts/885760fdc3b33793d41068b37b386ecdbaccb2c0/Vector%2019.svg');
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                transform: translateY(-50%) rotate(0deg);
                transition: transform 0.3s ease;
                pointer-events: none;
            }

            /* Поворот стрелки при открытии */
            .dropdown-wrapper.open .dropdown-arrow {
                transform: translateY(-50%) rotate(180deg);
            }

            /* Список опций */
            .dropdown-options {
                position: absolute;
                top: calc(100% + 4px);
                left: 0;
                width: 100%;
                background-color: black;
                border-width: 0;
                border-top: 2px solid white;
                border-left: 2px solid white;
                border-bottom: 2px solid white;
                border-radius: 10px;
                max-height: 0;
                overflow: hidden;
                opacity: 0;
                transition: max-height 0.3s ease, opacity 0.3s ease;
                z-index: 100;
            }

            /* Активное состояние списка */
            .dropdown-options.show {
                max-height: 150px;
                overflow-y: auto;
                list-style-type: none;
                opacity: 1;
                scrollbar-color: #FD8701 black;
                scrollbar-width: thin;
            }

            /* Элементы списка */
            .dropdown-item {
                padding: 12px 16px;
                cursor: pointer;
                transition: background-color 0.2s ease;
                white-space: nowrap;
                color: #fff;
                list-style-type: none;
            }

            .dropdown-item:hover {
                background-color: #FD8701;
                color: #fff;
                border-radius: 0.5rem;
            }


        
            /* variant 1 */
            .size-signboard {
                position: relative;
                width: 100%; 
            }

            .value-display {
                color: #f00;
                font-weight: bold;
                font-size: 16px;
                margin-bottom: 6px;
                user-select: none;
            }

            /* Стилизация input range */
            #size-signboard {
                width: 100%;
                -webkit-appearance: none;
                background: transparent;
                cursor: pointer;
                height: 2px;
                border-radius: 4px;
                background: #333;
                outline: none;
            }

            /* Визуальная полоса заполнения */
            #size-signboard::-webkit-slider-runnable-track {
                height: 2px;
                background: #555;
                border-radius: 4px;
            }

            #size-signboard::-moz-range-track {
                height: 2px;
                background: #555;
                border-radius: 4px;
            }

            /* Стрелка (ползунок) */
            #size-signboard::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 14px;
                height: 14px;
                background: #888;
                border-radius: 50%;
                border: 2px solid #fff;
                margin-top: -6px; 
                transition: background 0.3s ease;
            }

            #size-signboard::-webkit-slider-thumb:hover {
                background: #aaa;
            }

            #size-signboard::-moz-range-thumb {
                width: 14px;
                height: 14px;
                background: #888;
                border-radius: 50%;
                border: 2px solid #fff;
                transition: background 0.3s ease;
            }

            #size-signboard::-moz-range-thumb:hover {
                background: #aaa;
            }

            
            .size-signboard {
                position: relative;
            }

            .range-labels span {
                font-size: 10px;
                font-family: "Unbounded";
                color: #fff;
                user-select: none;
            }


           
            .size-signboard .ticks {
                display: flex;
                justify-content: space-between;
                margin-top: 4px;
                font-size: 12px;
                color: #fff;
                user-select: none;
            }

            #selectBaseWrapper .custom-options {
                max-height: 0;
                overflow: hidden;
                opacity: 0;
                transition: max-height 0.3s ease, opacity 0.3s ease;
            }

            
            #selectBaseWrapper .custom-options.show {
                max-height: 100px; 
                opacity: 1;
                overflow: hidden; 
            }

            #selectBaseWrapper .custom-options {
                border-right: 2px solid white;
            }

            /* color picker start*/
            .color-picker {
                color: white;
                font-family: sans-serif;
                max-width: 100%;
            }

            .label {
                font-size: 10px;
                margin-bottom: 12px;
            }

            .selected-label {
                font-size: 10px;
                margin-bottom: 10px;
            }

            .color-options {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 10px;
                max-width: 100%;
            }

            .color {
                width: 100%;
                aspect-ratio: 1 / 1;
                border-radius: 10px;
                cursor: pointer;
                box-shadow: 0 0 10px rgba(255, 255, 255, 0.6);
                transition: transform 0.2s, box-shadow 0.2s;
            }

            .color:hover {
                transform: scale(1.1);
            }

            .color.color-selected {
                box-shadow: 0 0 15px 5px white;
                outline: 2px solid white;
            }

                /* Адаптация текста на мелких экранах */
            @media (max-width: 480px) {
                .label {
                    font-size: 1rem;
                }

            .selected-label {
                    font-size: 0.9rem;
                }

            .color-options {
                    gap: 13px;
                }
            }

            /* color picker end */

            /* left block styles content end */

            @media (max-width: 1024px) {
                .wrapper {
                    grid-template-columns: 1fr;
                    grid-template-areas:
                        "right"
                        "left";
                    row-gap: 20px;
                    height: auto;
                    margin: 0 auto;
                    max-width: 480px;
                    width: 100%;
                }
                .right-block {
                    max-width: 480px;
                    background-position: center;
                }
                .left-block {
                    max-width: 480px;
                }
            }

            
            /* right block styles content start */
           .sign-preview {
                color: white;
                font-size: 32px;
                text-align: center;
                box-sizing: border-box;
                word-break: break-word;
                white-space: normal;         
                overflow-wrap: break-word;   
                text-align: center;
                max-width: 100%;
                padding: 20px;
                text-shadow:
                    0 0 2px #ffffff,
                    0 0 4px #ffffff,
                    0 0 6px #ffffff,
                    0 0 10px #ffffff,
                    0 0 15px #ffffff,
                    0 0 20px #ffffff;
            }

            .preview-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100%; 
                text-align: center;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                max-width: 100%;
                padding: 25px;
            }

           

            /* Контейнер мерной линии */
            .measure-line {
                position: relative;
                display: flex;
                align-items: center;
                height: 20px;
                margin-top: 5px;
            }
            
            /* Горизонтальная линия */
            .horizontal-line {
                height: 1px;
                background-color: #494949;
                width: 100px; 
            }

            /* Вертикальные крайние линии */
            .vertical-line {
                width: 1px;
                height: 10px;
                background-color: #494949;
            }

            .measure-line p {
                position: absolute;
                top: 15px;
                left: 50%;
                transform: translateX(-50%);
                color: #494949;
                font-family: "Unbounded";
                font-weight: 400;
                margin-top: 5px;
                font-size: 10px;
                text-align: center;
            }



            .toggle-buttons {
                display: flex;
                margin-bottom: 20px;
                position: absolute;
                top: 29px;
                left: 50px;
                gap: 15px;
            }

            /* Общий стиль для toggle */
            .toggle {
                position: relative;
                width: 70px;
                height: 34px;
                background: #ccc;
                border-radius: 5px;
                cursor: pointer;
                display: flex;
                align-items: center;
                padding: 2px;
                box-sizing: border-box;
            }

            /* Общая "кнопка" — кружок */
            .toggle .slider {
                position: absolute;
                top: 2px;
                left: 2px;
                width: 48%;
                height: 30px;
                background: #fff;
                border-radius: 5px;
                transition: transform 0.3s ease;
                z-index: 1;
            }

            /* Активный сдвиг */
            .toggle.active .slider {
                transform: translateX(33px);
            }

            /* ТЕКСТОВЫЙ переключатель */
            .toggle-text .label {
                flex: 1;
                text-align: center;
                z-index: 2;
                font-weight: bold;
                color: #333;
                margin: 0;
            font-size: 12px;
                font-family: "Unbounded";
                color: #00000080;
            }

            /* ИКОНКИ */
            .toggle-icon .icon {
                flex: 1;
                background-repeat: no-repeat;
                background-position: center;
                background-size: 20px 20px;
                height: 100%;
                z-index: 2;
            }


            .bg-buttons-container {
                display: flex;
                gap: 15px;
                position: absolute;
                left: 50%;
                transform: translateX(-50%);
                bottom: 14px;
            }

            .bg-button {
                width: 75px;
                height: 72px;
                
                border-radius: 8px;
                cursor: pointer;
                background-size: cover;
                background-position: center;
                transition: border-color 0.3s;
            }

            .bg-button:hover {
                transform: scale(1.1);
                box-shadow:
                0 0 5px rgba(255, 255, 255, 0.3),
                0 0 10px rgba(255, 255, 255, 0.3),
                0 0 15px rgba(255, 255, 255, 0.3);
            }
            .bg-button.active {
                box-shadow: 
                    0 0 5px #ffffff,
                    0 0 15px #ffffff,
                    0 0 20px #ffffff;
                transform: scale(1.1);
            }

            /* color bar */

            .color-slider-container {
                width: 100%;
                height: 20px;
                border-radius: 22px;
                overflow: hidden;
                cursor: pointer;
                margin-top: 1rem;
                position: relative;
            }

            .color-bar {
                width: 100%;
                height: 100%;
                background: linear-gradient(to right,
                    #ffffff,     
                    #fefbe9,     
                    #ffff00,     
                    #ff8000,     
                    #f4b4e7,     
                    #e290f2,     
                    #fb91df,     
                    #ff1b1b,    
                    #84f6ff,    
                    #59c3f7,     
                    #6be242,    
                    #00ff00,    
                    #0000ff,     
                    #000080     
                );
                border-radius: 8px;
                cursor: pointer;
                position: relative;
            }

            .range-track-wrapper {
                position: relative;
                width: 100%;
                height: 28px; /* чуть больше, чтобы вместить ticks */
            }

            .range-ticks {
                position: absolute;
                left: 0; right: 0; top: 50%;
                height: 8px;
                transform: translateY(-50%);
                width: 100%;
                pointer-events: none;
                border-radius: 8px;
                overflow: hidden;
                z-index: 1;
                /* Делаем фон прозрачным, только деления */
                background:
                    repeating-linear-gradient(
                        to right,
                        #ccc,
                        #ccc 2px,
                        transparent 2px,
                        transparent 18px
                    );
            }

            /* Загрузка шрифта с гитхаба */
            .font_1 { font-family: "Comic Code Ligatures Light Italic"; }
            .font_2 { font-family: 'Arsinova Deco'; }
            .font_3 { font-family: 'ACLine'; }
            .font_4 { font-family: 'UniSans-Trial-Thin'; }
            .font_5 { font-family: "Gilroy-Light"; }
            .font_6 { font-family: 'bauhaus'; }
            .font_7 { font-family: 'Uni Sans Thin Italic'; }
            .font_8 { font-family: 'Aqum 2 Classic'; }
            .font_9 { font-family: "_Myriad Pro"; }
            .font_10 { font-family: 'Bitter-Thin'; }
            .font_11 { font-family: 'bimbo-ballpoint'; }
            .font_12 { font-family: 'segoe-script'; }
            .font_13 { font-family: "Diamondgirl"; }
            .font_14 { font-family: 'mr_vlashu'; }
            .font_15 { font-family: 'gogoia-deco'; }
            .font_16 { font-family: 'slimamif'; }
            .font_17 { font-family: 'Vasek Italic_0'; }
            .font_18 { font-family: 'Repivmanusc'; }
            .font_19 { font-family: 'Repivmanusc-bold'; }
            .font_20 { font-family: 'Nickainley-Normal'; }
            .font_21 { font-family: 'Nickainley-normal'; }
            .font_22 { font-family: 'Monoton-Regular'; }
            .font_23 { font-family: 'Havana'; }
            .font_24 { font-family: 'Hastron'; }
            .font_25 { font-family: 'Pecita', cursive; }
            .font_26 { font-family: 'Train One'; }
            

            
            /* right block styles content end */
            .checkbox-row {
                width: 100%;
            }

            .checkbox-container {
                width: 100%;
                display: flex;
                align-items: center;
                gap: 24px;
                flex-wrap: wrap;
            }

            .checkbox-container .checkbox-label {
                margin-bottom: 0px;
            }

            .special-bg {
                background-color: #181818;
                padding: 10px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                gap: 7px;
                text-align: center;
                box-sizing: border-box;

            }

            .custom-checkbox {
                appearance: none;
                width: 20px;
                height: 20px;
                border: 2px solid #fff;
                border-radius: 6px;
                background: black;
                outline: none;
                cursor: pointer;
                position: relative;
                transition: border-color 0.2s, box-shadow 0.2s;
                display: inline-flex;
                justify-content: center;
                align-items: center;
                vertical-align: middle;
            }

            .checkbox-item {
                display: flex;
                align-items: center;
                gap: 7px;
                text-align: center;
            }

            .checkbox-item .checkbox-label {
                margin-bottom: 0px;
            }

            .custom-checkbox:checked {
                border-color: #FD8701;
                box-shadow: 0 0 6px #FD8701;
                background: #181818;
            }


            .custom-checkbox:checked::after {
                content: '';
                width: 6px;
                height: 10px;
                border: solid #FD8701;
                border-width: 0 2px 2px 0;
                transform: rotate(45deg);
                display: block;
            }

            .checkbox-label {
                color: #fff;
                font-family: "Unbounded";
                font-size: 13px;
                font-weight: 400;
                cursor: pointer;
                user-select: none;
                letter-spacing: 0.5px;
                transition: color 0.2s;
                display: inline-flex;
                align-items: center;
                gap: 7px;
            }

            .custom-checkbox:checked + .checkbox-label {
                color: #FD8701;
            }

            
            .align-block-label {
                color: #fff;
                font-family: 'Unbounded';
                font-size: 10px;
                margin-bottom: 7px;
                display: block;
            }
            #align-buttons {
                display: flex;
                gap: 10px;
            }
            .align-btn {
                width: 35px;
                height: 33px;
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 7px;
                border: 2px solid #fff;
                background: black;
                color: #fff;
                font-size: 18px;
                cursor: pointer;
                transition: border-color 0.2s;
                padding: 5px;
            }
            .align-btn.active {
                border-color: #FD8701;
            }

            .align-btn-bar {
                width: 18px;
                height: 4px;
                background: #fff;
                border-radius: 2px;
                margin: 0 auto;
                position: relative;
                display: block;
            }
            .align-btn.left .align-btn-bar {
                margin-left: 0;
                margin-right: auto;
            }
            .align-btn.center .align-btn-bar {
                margin: 0 auto;
            }
            .align-btn.right .align-btn-bar {
                margin-left: auto;
                margin-right: 0;
            }

            .align-btn-bar-group {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: flex-start;
                height: 100%;
                width: 100%;
                gap: 2px;
            }
            .align-btn.left .align-btn-bar-group {
                align-items: flex-start;
            }
            .align-btn.center .align-btn-bar-group {
                align-items: center;
            }
            .align-btn.right .align-btn-bar-group {
                align-items: flex-end;
            }
            .align-btn-bar {
                height: 2px;
                background: #fff;
                border-radius: 2px;
                display: block;
            }
            .align-btn-bar.bar1 { width: 18px; }
            .align-btn-bar.bar2 { width: 12px; }
            .align-btn-bar.bar3 { width: 7px; }

        </style>
    </head>
    <body>
        <div class="container">
            <div class="wrapper">
                <div class="left-block">
                    <h2 class="title-signboard">Создайте свою вывеску</h2>
                    <hr class="line-content"></hr>
                    <form action="" class="form-block">
                        <!-- <button class="button-form-calc" id="openModalBtn">Хочу такую</button> -->
                        <a class="button-form-calc" href="#popup:calcform">Рассчитать стоимость</a>
                        
                        <div class="field-signboard">
                            <label for="text-signboard">Текст вывески</label>
                            <textarea name="text-signboard" id="text-signboard" rows="2" maxlength="200" data-value="neonroom">neonroom</textarea>
                        </div>
                        
                       

                        <!-- Dropdown для выбора шрифта -->
                        <div>
                            <div class="font-dropdown" data-type="font" data-target="#preview">
                                <label for="font-select">Шрифт</label>
                                <div class="font-dropdown__selected" id="font-select" tabindex="0">
                                    <span class="font-dropdown__selected-text"></span>
                                    <span class="font-dropdown__preview">Аб / Ab</span>
                                    <span class="font-dropdown__arrow"></span>
                                </div>
                                <ul class="font-dropdown__list">
                                    <li class="font-dropdown__option" data-value="font_1" data-font="Comic Code Ligatures Light Italic">Шрифт 1</li>
                                    <li class="font-dropdown__option" data-value="font_2" data-font="Arsinova Deco">Шрифт 2</li>
                                    <li class="font-dropdown__option" data-value="font_3" data-font="ACLine">Шрифт 3</li>
                                    <li class="font-dropdown__option" data-value="font_4" data-font="UniSans-Trial-Thin">Шрифт 4</li>
                                    <li class="font-dropdown__option" data-value="font_5" data-font="Gilroy-Light">Шрифт 5</li>
                                    <li class="font-dropdown__option" data-value="font_6" data-font="bauhaus">Шрифт 6</li>
                                    <li class="font-dropdown__option" data-value="font_7" data-font="Uni Sans Thin Italic">Шрифт 7</li>
                                    <li class="font-dropdown__option" data-value="font_8" data-font="Aqum 2 Classic">Шрифт 8</li>
                                    <li class="font-dropdown__option" data-value="font_9" data-font="_Myriad Pro">Шрифт 9</li>
                                    <li class="font-dropdown__option" data-value="font_10" data-font="Bitter-Thin">Шрифт 10</li>
                                    <li class="font-dropdown__option" data-value="font_11" data-font="bimbo-ballpoint">Шрифт 11</li>
                                    <li class="font-dropdown__option" data-value="font_12" data-font="segoe-script">Шрифт 12</li>
                                    <li class="font-dropdown__option" data-value="font_13" data-font="Diamondgirl">Шрифт 13</li>
                                    <li class="font-dropdown__option" data-value="font_14" data-font="mr_vlashu">Шрифт 14</li>
                                    <li class="font-dropdown__option" data-value="font_15" data-font="gogoia-deco">Шрифт 15</li>
                                    <li class="font-dropdown__option" data-value="font_16" data-font="slimamif">Шрифт 16</li>
                                    <li class="font-dropdown__option" data-value="font_17" data-font="Vasek Italic_0">Шрифт 17</li>
                                    <li class="font-dropdown__option" data-value="font_18" data-font="Repivmanusc">Шрифт 18</li>
                                    <li class="font-dropdown__option" data-value="font_19" data-font="Repivmanusc-bold">Шрифт 19</li>
                                    <li class="font-dropdown__option" data-value="font_20" data-font="Nickainley-Normal">Шрифт 20</li>
                                    <li class="font-dropdown__option" data-value="font_21" data-font="Nickainley-normal">Шрифт 21</li>
                                    <li class="font-dropdown__option" data-value="font_22" data-font="Monoton-Regular">Шрифт 22</li>
                                    <li class="font-dropdown__option" data-value="font_23" data-font="Havana">Шрифт 23</li>
                                    <li class="font-dropdown__option" data-value="font_24" data-font="Hastron">Шрифт 24</li>
                                    <li class="font-dropdown__option" data-value="font_25" data-font="Pecita">Шрифт 25</li>
                                    <li class="font-dropdown__option" data-value="font_26" data-font="Train One">Шрифт 26</li>
                                </ul>
                            </div>
                        </div>

                        <div class="size-signboard">
                            <label>Длина вывески в (см)</label>
                            <div class="range-labels" style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                <span style="color: #fff;">30</span>
                                <span style="color: #fff;">300</span>
                            </div>
                            <div class="range-track-wrapper" style="position: relative; width: 100%;">
                                <input 
                                    type="range" 
                                    id="size-signboard" 
                                    name="size-signboard" 
                                    min="30" max="300" step="5" 
                                    value="90"
                                    style="width: 100%; position: relative; z-index: 2;"
                                >
                                <div class="range-ticks"></div>
                                <div 
                                    id="measure-label-point" 
                                    style="
                                        position: absolute;
                                        bottom: -12px;
                                        left: 0;
                                        transform: translateX(-50%);
                                        color: #fff;
                                        font-size: 10px;
                                        white-space: nowrap;
                                        pointer-events: none;
                                        transition: left 0.1s ease;
                                        font-family: Unbounded;
                                    "
                                >90 см</div>
                            </div>
                            
                        </div>

                        <div>
                            <div class="dropdown-wrapper" data-type="select-only">
                                <label for="base-select">Тип подложки</label>
                                <div class="dropdown-selected" id="base-select" tabindex="0">
                                    <span class="dropdown-text">Прямоугольная</span>
                                    <span class="dropdown-arrow"></span>
                                </div>
                                <ul class="dropdown-options">
                                    <li class="dropdown-item" data-value-form="Прямоугольная">
                                        <img src="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/неон/stand_rectangle.png" alt="Прямоугольная" style="width: 40px; height: auto; margin-right: 8px; vertical-align: middle;">
                                        Прямоугольная
                                    </li>
                                    <li class="dropdown-item" data-value-form="Контурная">
                                        <img src="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/неон/stand_figure.png" alt="Контурная" style="width: 40px; height: auto; margin-right: 8px; vertical-align: middle;">
                                        Контурная
                                    </li>
                                </ul>
                            </div>
                        </div>

                    
                        <div class="align-block">
                            <label class="align-block-label">Выравнивание текста</label>
                            <div id="align-buttons">
                                <button type="button" class="align-btn left" data-align="left">
                                    <span class="align-btn-bar-group">
                                        <span class="align-btn-bar bar1"></span>
                                        <span class="align-btn-bar bar2"></span>
                                        <span class="align-btn-bar bar3"></span>
                                    </span>
                                </button>
                                <button type="button" class="align-btn center" data-align="center">
                                    <span class="align-btn-bar-group">
                                        <span class="align-btn-bar bar1"></span>
                                        <span class="align-btn-bar bar2"></span>
                                        <span class="align-btn-bar bar3"></span>
                                    </span>
                                </button>
                                <button type="button" class="align-btn right" data-align="right">
                                    <span class="align-btn-bar-group">
                                        <span class="align-btn-bar bar1"></span>
                                        <span class="align-btn-bar bar2"></span>
                                        <span class="align-btn-bar bar3"></span>
                                    </span>
                                </button>
                            </div>
                        </div>

                        <div class="color-picker">
                            <p class="label">Цвет</p>
                            <p class="selected-label" id="selectedColorLabel">Холодный белый</p>
                            <div class="color-options" id="colorOptions">
                                <div class="color" data-color="white" style="background-color: #ffffff;"></div>
                                <div class="color" data-color="warmwhite" style="background-color: #fff694;"></div>
                                <div class="color" data-color="lightgreen" style="background-color: #00ffa2;"></div>
                                <div class="color" data-color="green" style="background-color: #00ff36;"></div>
                                <div class="color" data-color="yellow" style="background-color: #ffff00;"></div>
                                <div class="color" data-color="gold" style="background-color: #ffdd00;"></div>
                                <div class="color" data-color="orange" style="background-color: #ff6600;"></div>
                                <div class="color" data-color="red" style="background-color: #fe0000;"></div>
                                <div class="color" data-color="gently-pink" style="background-color: #ff94ce;"></div>
                                <div class="color" data-color="violet" style="background-color: #ff008a;"></div>
                                <div class="color" data-color="purple" style="background-color: #a200ff;"></div>
                                <div class="color" data-color="lightblue" style="background-color: #00b4ff;"></div>
                                <div class="color" data-color="darkblue" style="background-color: #001eff;"></div>
                                <div class="color" data-color="selected" style="background: linear-gradient(to right, red, yellow, green);"></div>
                            </div>

                            <!-- Скрытое поле для формы -->
                            <input type="hidden" name="selectedColorPlug" id="selectedColorPlug" value="white">
                        </div>

                        <div class="color-slider-container">
                            <div class="color-bar" id="colorBar"></div>
                        </div>

                        <a class="button-preview-neon" href="#popup1">Показать примеры</a>

                        
                        <div class="checkbox-row">
                            <label for="outdoor-checkbox">Тип вывески</label>
                            <div class="checkbox-container">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outdoor-checkbox" name="outdoor-checkbox" value="outdoor" class="custom-checkbox">
                                    <label for="outdoor-checkbox" class="checkbox-label">Уличная</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="indoor-checkbox" name="indoor-checkbox" value="indoor" class="custom-checkbox">
                                    <label for="indoor-checkbox" class="checkbox-label">Интерьерная</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="checkbox-row">
                            <label for="remote-control-checkbox">Дополнительные опции</label>
                            <div class="checkbox-container special-bg">
                                <input type="checkbox" id="remote-control-checkbox" name="remote-control-checkbox" value="remote-control" class="custom-checkbox">
                                <label for="remote-control-checkbox" class="checkbox-label">Пульт дистанционного управления</label>
                            </div>
                        </div>
                        
                        

                    </form>
                    
                
                </div>

                <div class="right-block" id="right-block">
                    
                    <div class="toggle-buttons">
                        <div class="toggle toggle-text" id="toggle-1">
                            <span class="label off">Off</span>
                            <span class="label on">On</span>
                            <span class="slider"></span>
                        </div>

                        <div class="toggle toggle-icon" id="toggle-2">
                            <span 
                                class="icon moon" 
                                style="background-image: url('https://raw.githubusercontent.com/anlapaev/fonts/ac916dee36a0343270add7d1e3001bfc1de46af3/Half%20moon.svg');"></span>
                            <span 
                                class="icon sun" 
                                style="background-image: url('https://raw.githubusercontent.com/anlapaev/fonts/ac916dee36a0343270add7d1e3001bfc1de46af3/Sunny%20Day.svg');"></span>
                            <span class="slider"></span>
                        </div>
                    </div>

                    <div class="preview-container">
                        <div id="preview" class="sign-preview font_modern">neonrommnn.com</div>

                        <!-- Мерная линия -->
                        <div class="measure-line">
                            <div class="vertical-line"></div>
                            <div class="horizontal-line"></div>
                            <div class="vertical-line"></div>
                            <p id="measure-label">90 см</p>
                        </div>
                    </div>

                    <div class="bg-buttons-container">
                        <div 
                            class="bg-button active" 
                            style="background-image: url('https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/seryi_divan_v_inter_ere_beloi_gostinoi_s_kopiei_prostranstva_3d%20(4).jpg')" 
                            data-day-bg="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/seryi_divan_v_inter_ere_beloi_gostinoi_s_kopiei_prostranstva_3d%20(3).jpg"
                            data-night-bg="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/seryi_divan_v_inter_ere_beloi_gostinoi_s_kopiei_prostranstva_3d%20(4).jpg"></div>

                        <div 
                            class="bg-button" 
                            style="background-image: url('https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/kreslo-v-cernoi-gostinoi-s-kopiei-prostranstva%204.jpg')" 
                            data-day-bg="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/kreslo-v-cernoi-gostinoi-s-kopiei-prostranstva%203.jpg"
                            data-night-bg="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/kreslo-v-cernoi-gostinoi-s-kopiei-prostranstva%204.jpg"></div>

                        <div 
                            class="bg-button" 
                            style="background-image: url('https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/seryi-divan-v-koricnevoi-gostinoi-s-kopiei-prostranstva%203.jpg')" 
                            data-day-bg="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/seryi-divan-v-koricnevoi-gostinoi-s-kopiei-prostranstva%204.jpg"
                            data-night-bg="https://raw.githubusercontent.com/anlapaev/fonts/refs/heads/main/Фоны.%2014.07.2025/seryi-divan-v-koricnevoi-gostinoi-s-kopiei-prostranstva%203.jpg"></div>
                    </div>
                
                </div>
                
            </div>
            <div class="t-upwidget-container" data-tilda-name="Изображение" data-tilda-upload-url="https://up.tilda.ws" data-tilda-upwidget-multiple="false" data-tilda-accept="image/*" data-tilda-field-name="Изображение"></div>
            <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

        </div>
        <script>
        
            const GAS_URL = "https://script.google.com/macros/s/AKfycbylXNq9oJrGn4NQC4hc7S2YJmVo9fPv6IQrPzCi0u2GzOn88vj3nHbi_JaFh-sApsCD/exec";
const IS_IOS = /iP(ad|hone|od)/.test(navigator.userAgent) ||
                 (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);

  function nowStamp() {
    const d = new Date();
    return d.toISOString().replace(/[-:T]/g,"").split(".")[0];
  }

  // ---------- помощники для картинок/шрифтов ----------
  async function ensureFontsReady() {
    if (document.fonts && document.fonts.ready) {
      try { await document.fonts.ready; } catch {}
    }
  }

  async function preloadImgs(urls) {
    await Promise.all(urls.map(src => new Promise(res => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = img.onerror = () => res();
      img.src = src;
    })));
  }

  // Собираем URL фоновых картинок в пределах root
  function collectBgUrls(root) {
    const urls = new Set();
    const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, null);
    while (walker.nextNode()) {
      const el = walker.currentNode;
      const bg = getComputedStyle(el).backgroundImage;
      const matches = bg && bg.match(/url\((['"]?)(.*?)\1\)/g);
      if (!matches) continue;
      matches.forEach(m => {
        const u = m.replace(/url\((['"]?)(.*?)\1\)/, "$2");
        if (u && !u.startsWith("data:")) urls.add(u);
      });
    }
    return [...urls];
  }

  // На iOS переводим background-image:url(...) → data:... (чтобы точно не таинтилось)
  async function inlineBackgrounds(root) {
    if (!IS_IOS) return { changed: [], restore(){} };

    const changed = [];
    const walker = document.createTreeWalker(root, NodeFilter.SHOW_ELEMENT, null);

    // кэш, чтобы одну и ту же картинку не грузить много раз
    const cache = new Map();

    async function toDataUrl(url) {
      if (cache.has(url)) return cache.get(url);
      const resp = await fetch(url, { mode: "cors" });
      const blob = await resp.blob();
      const dataUrl = await new Promise(r => {
        const fr = new FileReader();
        fr.onloadend = () => r(fr.result);
        fr.readAsDataURL(blob);
      });
      cache.set(url, dataUrl);
      return dataUrl;
    }

    const tasks = [];

    while (walker.nextNode()) {
      const el = walker.currentNode;
      const style = getComputedStyle(el);
      const bg = style.backgroundImage;
      if (!bg || bg === "none") continue;

      const matches = bg.match(/url\((['"]?)(.*?)\1\)/g);
      if (!matches) continue;

      // сохраняем оригинал, будем менять инлайн стилем
      const original = el.style.backgroundImage; // что было в inline-стилях
      const urls = matches.map(m => m.replace(/url\((['"]?)(.*?)\1\)/, "$2"))
                          .filter(u => u && !u.startsWith("data:"));
      if (!urls.length) continue;

      tasks.push((async () => {
        try {
          const dataUrls = [];
          for (const u of urls) {
            const data = await toDataUrl(u);
            dataUrls.push(`url("${data}")`);
          }
          el.style.backgroundImage = dataUrls.join(", ");
          changed.push({ el, original });
        } catch (e) {
          // если что-то не получилось — просто пропустим элемент
        }
      })());
    }

    await Promise.all(tasks);

    return {
      changed,
      restore() {
        for (const { el, original } of changed) {
          el.style.backgroundImage = original || "";
        }
      }
    };
  }

  async function ensureFontsAndImagesReady(root) {
    await ensureFontsReady();
    // для не-iOS просто прелоадим внешние фоновые картинки
    if (!IS_IOS) {
      const urls = collectBgUrls(root);
      if (urls.length) await preloadImgs(urls);
    }
  }

  // ---------- безопасное получение blob ----------
  function canvasToBlobSafe(canvas, mime="image/png", quality=0.92) {
    return new Promise((resolve, reject) => {
      if (!canvas.toBlob) {
        try {
          const dataURL = canvas.toDataURL(mime, quality);
          const bstr = atob(dataURL.split(',')[1]);
          const len = bstr.length;
          const u8 = new Uint8Array(len);
          for (let i = 0; i < len; i++) u8[i] = bstr.charCodeAt(i);
          return resolve(new Blob([u8], { type: mime }));
        } catch (e) {
          return reject(e);
        }
      }
      canvas.toBlob(b => {
        if (b) resolve(b);
        else {
          try {
            const dataURL = canvas.toDataURL(mime, quality);
            const bstr = atob(dataURL.split(',')[1]);
            const len = bstr.length;
            const u8 = new Uint8Array(len);
            for (let i = 0; i < len; i++) u8[i] = bstr.charCodeAt(i);
            resolve(new Blob([u8], { type: mime }));
          } catch (e) {
            reject(new Error("toBlob/toDataURL failed"));
          }
        }
      }, mime, quality);
    });
  }

  async function captureElement(el) {
    // 1) инлайн фоны на iOS
    const inlined = await inlineBackgrounds(el);
    try {
      // 2) дождаться шрифтов/картинок
      await ensureFontsAndImagesReady(el);

      // 3) сам захват
      const canvas = await html2canvas(el, {
        scale: IS_IOS ? 1 : Math.min(window.devicePixelRatio || 1, 2),
        useCORS: true,
        allowTaint: false,
        backgroundColor: null,
        scrollX: 0,
        scrollY: 0,
        windowWidth: document.documentElement.clientWidth,
        windowHeight: document.documentElement.clientHeight
      });
      // 4) blob + двойной fallback
      return await canvasToBlobSafe(canvas, "image/png", 0.9);
    } finally {
      // 5) вернуть исходные background-image
      inlined.restore?.();
    }
  }

  // ---------- загрузка как в «идеальном» ----------
  async function uploadToDrive(blob, filename) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onloadend = function() {
        const base64Data = reader.result.split(',')[1];
        const formData = new FormData();
        formData.append('filename', filename);
        formData.append('filedata', base64Data);

        const xhr = new XMLHttpRequest();
        xhr.open('POST', GAS_URL, true);
        xhr.onload = function() {
          if (xhr.status >= 200 && xhr.status < 300) {
            try {
              const response = JSON.parse(xhr.responseText);
              if (response.success && response.link) resolve(response.link);
              else reject(new Error(response.error || 'Неизвестная ошибка'));
            } catch (e) {
              const fileIdMatch = xhr.responseText.match(/file\/d\/([^\/]+)/);
              if (fileIdMatch && fileIdMatch[1]) {
                const directLink = "https://drive.google.com/uc?export=download&id=" + fileIdMatch[1];
                resolve(directLink);
              } else reject(new Error('Не удалось получить ссылку'));
            }
          } else {
            reject(new Error('Ошибка сервера: ' + xhr.status));
          }
        };
        xhr.onerror = function() { reject(new Error('Ошибка сети')); };
        xhr.send(formData);
      };
      reader.readAsDataURL(blob);
    });
  }

  async function makeScreenshotAndSend(callback) {
    try {
      const block = document.getElementById("right-block");
      if (!block) throw new Error("right-block не найден");
      const blob = await captureElement(block);
      const filename = "neon-calc-" + nowStamp() + ".png";
      const link = await uploadToDrive(blob, filename);
      callback(link);
    } catch (err) {
      console.error("[capture/upload error]", err);
      callback(null);
    }
  }

  function ensureHiddenInput(form) {
    let hidden = form?.querySelector('input[name="Изображение"]');
    if (!hidden && form) {
      hidden = document.createElement("input");
      hidden.type = "hidden";
      hidden.name = "Изображение";
      form.appendChild(hidden);
    }
    return hidden;
  }

  function observePopupOpen() {
    const popup = document.querySelector('[data-tooltip-hook="#popup:calcform"]');
    if (!popup) return console.warn('Popup не найден');

    const observer = new MutationObserver(function(mutations) {
      mutations.forEach(function(mutation) {
        if (mutation.attributeName === 'class' && popup.classList.contains('t-popup_show')) {
          const formPopup = document.querySelector(".uc-calc-form") || document.querySelector("form");
          const submitButton = formPopup?.querySelector('button[type="submit"]');
          const textSpan = submitButton?.querySelector(".t-btnflex__text") || submitButton;
          const hiddenInput = ensureHiddenInput(formPopup);

          if (submitButton && textSpan && hiddenInput) {
            const baseText = "Узнать стоимость";
            const loadText = "Обрабатываем макет";
            let dots = 0;

            submitButton.style.pointerEvents = "none";
            textSpan.textContent = loadText;

            const intervalId = setInterval(() => {
              dots = (dots + 1) % 4;
              textSpan.textContent = loadText + ".".repeat(dots);
            }, 500);

            const delay = IS_IOS ? 300 : 50;
            setTimeout(() => {
              makeScreenshotAndSend(function(fileUrl) {
                clearInterval(intervalId);
                if (fileUrl) {
                  hiddenInput.value = fileUrl;
                  textSpan.textContent = baseText;
                  submitButton.style.pointerEvents = "auto";
                } else {
                  textSpan.textContent = "Ошибка загрузки";
                  submitButton.style.pointerEvents = "none";
                }
              });
            }, delay);
          }
        }
      });
    });

    observer.observe(popup, { attributes: true, attributeFilter: ['class'] });
  }

  document.addEventListener("DOMContentLoaded", observePopupOpen);
        
            // const GAS_URL = "https://script.google.com/macros/s/AKfycbymCZ_gdJe3M-gDlwMsx9aeuI7y1fQhUFlPPmgf2AbqWlciXwNz12pYsVDMSnQDwMvN/exec";

            // async function uploadToGoogleDrive(blob) {
            //     const base64 = await new Promise(res => {
            //         const reader = new FileReader();
            //         reader.onloadend = () => res(reader.result.split(',')[1]);
            //         reader.readAsDataURL(blob);
            //     });
                
            //      const body = new URLSearchParams({
            //         data: base64,
            //         mimeType: blob.type,
            //         filename: `screenshot_${Date.now()}.png`
            //     });
            //     const response = await fetch(
            //         "https://script.google.com/macros/s/AKfycbzR_rpCOyZc2Ztp9IifBOuzHp-mVa4zKxFmpIsbmfrsnQvs5N_AEdzl_GQGa7EHzKK_/exec",
            //         {
            //             method: "POST",
            //             body
            //         }
            //     );
            
            //     const result = await response.json();
            //     return result.direct; 
            // }
            
            // async function makeScreenshotAndSend(onComplete) {
            //     const node = document.querySelector('.right-block');
            //     const canvas = await html2canvas(node, { useCORS: true, backgroundColor: null });
            //     const blob = await new Promise(res => canvas.toBlob(res, 'image/png'));
            
            //     const fileUrl = await uploadToGoogleDrive(blob);
            
            //     let hidden = document.querySelector('input[name="Изображение"]');
            //     if (!hidden) {
            //         hidden = document.createElement('input');
            //         hidden.type = 'hidden';
            //         hidden.name = 'Изображение';
            //         document.querySelector('form').appendChild(hidden);
            //     }
            //     hidden.value = fileUrl;
            
            //     if (typeof onComplete === "function") {
            //         onComplete(fileUrl);
            //     }
            // }
            
            // function observePopupOpen() {
            //     const popup = document.querySelector('[data-tooltip-hook="#popup:calcform"]');
            //     if (!popup) return console.warn('Popup не найден');
            
            //     const observer = new MutationObserver(mutations => {
            //         for (const mutation of mutations) {
            //             if (mutation.attributeName === 'class') {
            //                 if (popup.classList.contains('t-popup_show')) {
            
            //                     let hidden = document.querySelector('input[name="Изображение"]');
            //                     if (hidden) hidden.value = "";
            
            //                     const formPopup = document.querySelector(".uc-calc-form");
            //                     const submitButton = formPopup?.querySelector('button[type="submit"]');
            //                     const textSpan = submitButton?.querySelector(".t-btnflex__text");
            
            //                     if (submitButton && textSpan) {
            //                         let baseText = "Узнать стоимость";
            //                         let loadText = "Обрабатываем макет";
            //                         let dots = 0;
            
            //                         submitButton.style.pointerEvents = "none";
            //                         const intervalId = setInterval(() => {
            //                             dots = (dots + 1) % 4;
            //                             textSpan.textContent = loadText + ".".repeat(dots);
            //                         }, 500);
            
                                  
            //                         makeScreenshotAndSend((fileUrl) => {
            //                             if (fileUrl) {
            //                                 clearInterval(intervalId);
            //                                 textSpan.textContent = baseText; 
            //                                 submitButton.style.pointerEvents = "auto"; 
            //                             }
            //                         });
            //                     }
            //                 }
            //             }
            //         }
            //     });
            
            //     observer.observe(popup, { attributes: true, attributeFilter: ['class'] });
            // }
            
            // window.addEventListener('load', () => {
            //     observePopupOpen();
            // });



            let selected_RGB = false;
            let selected_color_name = null;
            let selected_color_off = null;
            let savedTextShadow = '';
            colorLabelsParent = {
                'white': 'Холодный белый',
                'warmwhite': 'Тёплый белый',
                'lightgreen': 'Светло-зелёный',
                'green': 'Зелёный',
                'yellow': 'Лимонный',
                'gold': 'Жёлто-золотистый',
                'orange': 'Оранжевый',
                'red': 'Красный',
                'gently-pink': 'Нежно-розовый',
                'purple': 'Фиолетовый',
                'violet': 'Розовый',
                'lightblue': 'Голубой',
                'darkblue': 'Тёмно-синий',
                'selected': 'Многоцветный-адресный'
            }
            const colorNames = {
                '#ffffff': 'Холодный белый',
                '#fefbe9': 'Тёплый белый',
                '#ffff00': 'Лимонный',
                '#ffd700': 'Жёлто-золотистый',
                '#ff8000': 'Оранжевый',
                '#f4b4e7': 'Розовый',
                '#e290f2': 'Фиолетовый',
                '#fb91df': 'Красный',
                '#ff1b1b': 'Голубой',
                '#84f6ff': 'Голубой',
                '#59c3f7': 'Зелёный',
                '#6be242': 'Зелёный',
                '#00ff00': 'Зелёный',
                '#0000ff': 'Тёмно-синий',
            };
            const glowColors = {
                'white': [
                    'rgb(255, 255, 255) 0px 0px 2px',
                    'rgb(51, 51, 51) 0px 0px 3px',
                    'rgb(255, 255, 255) 0px 0px 4px',
                    'rgb(255, 255, 255) 0px 0px 5px',
                    'rgb(255, 255, 255) 0px 0px 5px',
                    'rgb(255, 255, 255) 0px 0px 7px',
                    'rgb(255, 255, 255) 0px 0px 20px',
                    'rgb(255, 255, 255) 0px 0px 23px',
                    'rgb(255, 255, 255) 0px 0px 26px',
                    'rgb(255, 255, 255) 0px 0px 27px',
                    'rgb(255, 255, 255) 0px 0px 30px',
                    'rgb(255, 255, 255) 0px 0px 33px',
                    'rgb(255, 255, 255) 0px 0px 36px',
                    'rgb(255, 255, 255) 0px 0px 39px',
                ],
                'warmwhite': Array.from({ length: 14 }, (_, i) => `#fff694 0px 0px ${i * 3 + 2}px`),
                'lightgreen': Array.from({ length: 14 }, (_, i) => `#00ffa2 0px 0px ${i * 3 + 2}px`),
                'green': Array.from({ length: 14 }, (_, i) => `#00ff36 0px 0px ${i * 3 + 2}px`),
                'yellow': Array.from({ length: 14 }, (_, i) => `#ffff00 0px 0px ${i * 3 + 2}px`),
                'gold': Array.from({ length: 14 }, (_, i) => `#ffdd00 0px 0px ${i * 3 + 2}px`),
                'orange': Array.from({ length: 14 }, (_, i) => `#ff6600 0px 0px ${i * 3 + 2}px`),
                'red': Array.from({ length: 14 }, (_, i) => `#fe0000 0px 0px ${i * 3 + 2}px`),
                'gently-pink': Array.from({ length: 14 }, (_, i) => `#ffb3e6 0px 0px ${i * 3 + 3}px`),
                'purple': Array.from({ length: 14 }, (_, i) => `#a200ff 0px 0px ${i * 3 + 2}px`),
                'violet': Array.from({ length: 14 }, (_, i) => `#ff008a 0px 0px ${i * 3 + 2}px`),
                'lightblue': Array.from({ length: 14 }, (_, i) => `#00b4ff 0px 0px ${i * 4 + 4}px`),
                'darkblue': Array.from({ length: 14 }, (_, i) => `#001eff 0px 0px ${i * 3 + 2}px`),
                'selected': [
                    '0 0 4px #ff0000',
                    '0 0 10px #ffff00',
                    '0 0 20px #00ff00'
                ]
            };


            function initFontDropdown() {
                document.addEventListener("DOMContentLoaded", () => {
                    const select = document.querySelector(".font-dropdown");
                    if (!select) return;

                    const selected = select.querySelector(".font-dropdown__selected");
                    const selectedText = selected.querySelector(".font-dropdown__selected-text");
                    const selectedPreview = selected.querySelector(".font-dropdown__preview");
                    const options = select.querySelector(".font-dropdown__list");
                    const items = options.querySelectorAll(".font-dropdown__option");

                    //Удаляем добавление preview-спана к option
                    items.forEach((option) => {
                        const fontName = option.dataset.font;
                        if (!fontName) return;
                        const preview = document.createElement('span');
                        preview.className = 'font-preview';
                        preview.textContent = option.getAttribute('data-preview') || 'Аб / Ab';
                        preview.style.fontFamily = `'${fontName}'`;
                        preview.style.marginLeft = '10px';
                        option.appendChild(preview);
                    })
                    
                    function applyItem(select, item) {
                        const selectedText = select.querySelector(".font-dropdown__selected-text");
                        const selectedPreview = select.querySelector(".font-dropdown__preview");
                        const value = item.getAttribute("data-value");
                        const name =  item.childNodes[0].textContent.trim();
                        const fontName = item.getAttribute('data-font');
                        const previewText = item.getAttribute('data-preview') || 'Аб / Ab';
                        const type = select.getAttribute("data-type");
                        const targetSelector = select.getAttribute("data-target");
                       
                        if (selectedText) {
                            selectedText.textContent = name;
                        }
                        if (selectedPreview) {
                            selectedPreview.textContent = previewText;
                            selectedPreview.style.fontFamily = `'${fontName}'`;
                        }
                        if (type === "font") {
                            const target = document.querySelector(targetSelector);
                            if (target) {
                                target.className = target.className.replace(/\bfont_\d+\b/g, '').trim();
                                target.classList.add(value);
                            }
                            document.querySelector('input[name="Выбранный шрифт"]').value = fontName || '';
                        }
                    }

                    if (items.length > 0) {
                        setTimeout(() => applyItem(select, items[0]), 0);
                    }

                    selected.addEventListener("click", (e) => {
                        e.stopPropagation();
                        select.classList.toggle("open");
                        options.classList.toggle("show");
                    });

                    items.forEach((item) => {
                        item.addEventListener("click", () => {
                            applyItem(select, item);
                            select.classList.remove("open");
                            options.classList.remove("show");
                        });
                    });

                    document.addEventListener("click", (e) => {
                        if (!select.contains(e.target)) {
                            select.classList.remove("open");
                            options.classList.remove("show");
                        }
                    });
                });
            }

            // Выбор подложки 

            document.addEventListener("DOMContentLoaded", () => {
                const dropdownWrapper = document.querySelector(".dropdown-wrapper");
                const selected = dropdownWrapper.querySelector(".dropdown-selected");
                const dropdownText = selected.querySelector(".dropdown-text");
                const optionsList = dropdownWrapper.querySelector(".dropdown-options");
                const options = optionsList.querySelectorAll(".dropdown-item");
                const dropdownSelected = document.getElementById('base-select');
                const hiddenInput = document.querySelector('input[type="hidden"][name="Тип подложки"]');


                // Переключение открытия/закрытия
                selected.addEventListener("click", () => {
                    dropdownWrapper.classList.toggle("open");
                    optionsList.classList.toggle("show");
                });

                //Выбор опции
                options.forEach(option => {
                    option.addEventListener("click", (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const selectedValue = option.getAttribute("data-value-form");
                        const selectedText = option.textContent;
                        hiddenInput.value = selectedValue;  

                        dropdownText.textContent = selectedText;
                        dropdownWrapper.classList.remove("open");
                        optionsList.classList.remove("show");
                    });
                });

                // Закрытие при клике вне
                document.addEventListener("click", (e) => {
                    if (!dropdownWrapper.contains(e.target)) {
                        dropdownWrapper.classList.remove("open");
                        optionsList.classList.remove("show");
                    }
                });
            });


            // Дропдауны конец


            document.addEventListener('DOMContentLoaded', () => {
                const sizeInput = document.getElementById('size-signboard');
                const measureLabel = document.getElementById('measure-label');
                const line = document.getElementById('line-to-resize');
                const measureLabelPoint = document.getElementById('measure-label-point');
                const hiddenInput = document.querySelector('input[type="hidden"][name="Ширина вывески"]');

                sizeInput.addEventListener('input', () => {
                    hiddenInput.value = sizeInput.value;
                });

                const MIN = 30;
                const MAX = 300;

                function updateUI(value) {
                    const width = Math.min(Math.max(parseInt(value), MIN), MAX);
                    measureLabel.textContent = `${width} см`;
                    if (line) line.style.width = `${width}px`;
                }

                function updateLabelPosition() {
                    const value = parseInt(sizeInput.value, 10);
                    const percent = (value - MIN) / (MAX - MIN);
                    const inputWidth = sizeInput.offsetWidth;
                    const thumbWidth = 14; // px, как в CSS
                    const offset = thumbWidth / 2;
                    const left = percent * (inputWidth - thumbWidth) + offset;
                    measureLabelPoint.style.left = `${left}px`;
                    measureLabelPoint.textContent = `${value} см`;
                }

                sizeInput.addEventListener('input', (e) => {
                    updateUI(e.target.value);
                    updateLabelPosition();
                });
                window.addEventListener('resize', updateLabelPosition);
                updateUI(sizeInput.value);
                updateLabelPosition();
            });


            function initColorBar() {
                const colorBar = document.getElementById('colorBar');
                const preview = document.getElementById('preview');
                const toggle = document.getElementById('toggle-1');
                const colorOptions = document.querySelectorAll('#colorOptions .color');

                if (!colorBar || !preview) return;

                const gradientColors = [
                    '#ffffff', '#fefbe9', '#ffff00', '#ffd700',
                    '#ff8000', '#f4b4e7', '#e290f2', '#fb91df',
                    '#ff1b1b', '#84f6ff', '#59c3f7', '#6be242',
                    '#00ff00', '#0000ff', '#000080'
                ];
                

                let isMouseDown = false;

                function interpolateColor(color1, color2, factor) {
                    const c1 = color1.match(/\w\w/g).map(hex => parseInt(hex, 16));
                    const c2 = color2.match(/\w\w/g).map(hex => parseInt(hex, 16));
                    const result = c1.map((c, i) => Math.round(c + (c2[i] - c) * factor));
                    return `rgb(${result.join(',')})`;
                }

                function updateColor(e) {
                    if (!isMouseDown) return;

                    // Убираем выделение у всех color-кнопок
                    colorOptions.forEach(el => el.classList.remove('color-selected'));

                    const rect = colorBar.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const percent = Math.max(0, Math.min(1, x / rect.width));

                    const total = gradientColors.length - 1;
                    const index = Math.floor(percent * total);
                    const factor = (percent * total) - index;

                    const color = interpolateColor(
                        gradientColors[index],
                        gradientColors[index + 1] || gradientColors[index],
                        factor
                    );

                    if (window.rainbowInterval) {
                        clearInterval(window.rainbowInterval);
                        window.rainbowInterval = null;
                    }

                    // Проверяем состояние тоггла свечения
                    if (toggle.classList.contains('active')) {
                        preview.style.textShadow = `
                            0.5px 0.5px 0.5px black,
                            0 0 4px ${color},
                            0 0 6px ${color},
                            0 0 8px ${color},
                            0 0 10px ${color},
                            0 0 12px ${color},
                            0 0 16px ${color},
                            0 0 18px ${color},
                            0 0 20px ${color},
                            0 0 22px ${color},
                            0 0 24px ${color},
                            0 0 40px ${color},
                            0 0 60px ${color}
                        `;
                        
                        preview.style.color = 'white';
                    } else {
                        preview.style.textShadow = 'none';
                        preview.style.color = color;
                    }
                    preview.classList.remove('rainbow-text');
                    savedTextShadow = preview.style.textShadow;
                    const baseColor = gradientColors[index];
                    const colorName = colorNames[baseColor] || 'Тёмно-синий';

                    selectedColorLabel.textContent = colorName;
                    const hiddenColorInput = document.querySelector('input[type="hidden"][name="Выбранный цвет"]'); 
                    if (hiddenColorInput) {
                        if (colorNames[baseColor] !== undefined) {
                            hiddenColorInput.value = colorNames[baseColor];
                        }
                    }
                }

                colorBar.addEventListener('mousedown', (e) => {
                    isMouseDown = true;
                    updateColor(e);
                });

                document.addEventListener('mouseup', () => {
                    isMouseDown = false;
                });

                document.addEventListener('mousemove', (e) => {
                    updateColor(e);
                });
            }



            function initColorPicker(options = {}) {
                const {
                    colorSelector = '.color',
                    inputSelector = '#selectedColorPlug',
                    labelSelector = '#selectedColorLabel',
                    
                    colorLabels = {
                        'white': 'Холодный белый',
                        'warmwhite': 'Тёплый белый',
                        'lightgreen': 'Светло-зелёный',
                        'green': 'Зелёный',
                        'yellow': 'Лимонный',
                        'gold': 'Жёлто-золотистый',
                        'orange': 'Оранжевый',
                        'red': 'Красный',
                        'gently-pink': 'Нежно-розовый',
                        'purple': 'Фиолетовый',
                        'violet': 'Розовый',
                        'lightblue': 'Голубой',
                        'darkblue': 'Тёмно-синий',
                        'selected': 'Многоцветный-адресный'
                    }
                } = options;
                
                const colorOptions = document.querySelectorAll(colorSelector);
                const selectedColorInput = document.querySelector(inputSelector);
                const selectedLabel = document.querySelector(labelSelector);
                const preview = document.querySelector('#preview');
                
                if (!colorOptions.length || !selectedColorInput || !selectedLabel) {
                    console.warn('initColorPicker: один из элементов не найден');
                    return;
                }

                const colorToHref = {
                    'white': '#popup1',
                    'warmwhite': '#popup2',
                    'lightgreen': '#popup4',
                    'green': '#popup3',
                    'yellow': '#popup5',
                    'gold': '#popup6',
                    'orange': '#popup7',
                    'red': '#popup8',
                    'gently-pink': '#popup9',
                    'purple': '#popup11',
                    'violet': '#popup10',
                    'lightblue': '#popup12',
                    'darkblue': '#popup13',
                    'selected': '#popup14'
                };
                const showExamplesBtn = document.querySelector('.button-preview-neon');
                const colorOptionsPreview = document.querySelectorAll('#colorOptions .color');
                colorOptionsPreview.forEach(option => {
                    option.addEventListener('click', function() {
                        const color = option.getAttribute('data-color');
                        if (showExamplesBtn && colorToHref[color]) {
                            showExamplesBtn.setAttribute('href', colorToHref[color]);
                        }
                    });
                });
                
                // Функция обновления предпросмотра
                

            function updatePreview(color) {
                preview.classList.remove('rainbow-text');
                const hiddenColorInput = document.querySelector('input[type="hidden"][name="Выбранный цвет"]'); 
                if (hiddenColorInput) {
                    hiddenColorInput.value = colorLabels[color];
                }
                
                
                if (color === 'selected') {
                    // Плавная смена цвета с пульсацией
                    const colors = ['white', 'warmwhite', 'lightgreen', 'green', 'yellow', 'gold', 'orange', 'red', 'gently-pink', 'purple', 'violet', 'lightblue', 'darkblue'];
                    let index = 0;
                    let opacity = 1;
                    let increasing = false;
                    selected_RGB = true;
                    selected_color_name = color;

                    // Очищаем предыдущий интервал если он есть
                    if (window.rainbowInterval) {
                        clearInterval(window.rainbowInterval);
                    }
                    
                    
                } else {
                    
                    selected_RGB = false;
                    if (window.rainbowInterval) {
                        clearInterval(window.rainbowInterval);
                        window.rainbowInterval = null;
                    }
                    preview.style.textShadow = glowColors[color].join(', ');
                }
            }

                // Обработчики для цветов
            colorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    colorOptions.forEach(el => el.classList.remove('color-selected'));
                        option.classList.add('color-selected');
                        const value = option.dataset.color;
                        selected_color_off = value;
                        selectedColorInput.value = value;
                        selectedLabel.textContent = colorLabels[value] || value;
                        updatePreview(value);
                });
            });

                const initial = selectedColorInput.value;
                updatePreview(initial);
                // Инициализация текущего цвета
                const currentColor = selectedColorInput.value;
                const currentOption = [...colorOptions].find(opt => opt.dataset.color === currentColor);
                if (currentOption) {
                    currentOption.classList.add('color-selected');
                    updatePreview(currentColor);
                }
            }
            
            // Функция смены цвета неона
            function initSignboardPreview() {
                const textarea = document.getElementById('text-signboard');
                const preview = document.getElementById('preview');
                const colorOptions = document.querySelectorAll('#colorOptions .color');
                const selectedColorInput = document.getElementById('selectedColorPlug');
                const selectedColorLabel = document.getElementById('selectedColorLabel');
                const toggle = document.getElementById('toggle-1');
                const selectDisplay = document.querySelector('.font-dropdown__selected-text');
                const fontOptions = document.querySelectorAll('.font-dropdown__list li');

                // Состояние
                const state = {
                    glowEnabled: true,
                    selectedColor: selectedColorInput.value || 'white',
                    rainbowInterval: null
                };

                // Получить тень для цвета
                function getGlowShadow(color) {
                    if (color === 'selected') {
                        // Для rainbow — возвращаем null, т.к. будет анимация
                        return null;
                    }
                    // Обычная тень для цвета
                    return `
                        0.5px 0.5px 0.5px black,
                        0 0 4px ${color},
                        0 0 6px ${color},
                        0 0 8px ${color},
                        0 0 10px ${color},
                        0 0 12px ${color},
                        0 0 16px ${color},
                        0 0 18px ${color},
                        0 0 20px ${color},
                        0 0 22px ${color},
                        0 0 24px ${color},
                        0 0 40px ${color}
                    `;
                }

                // Применить свечение
                function applyGlow() {
                    // Остановить rainbow, если был
                    if (window.rainbowInterval) {
                        clearInterval(window.rainbowInterval);
                        window.rainbowInterval = null;
                    }
                    if (state.glowEnabled) {
                        if (state.selectedColor === 'selected') {
                            // Анимация rainbow
                            const colors = ['white', 'warmwhite', 'lightgreen', 'green', 'yellow', 'gold', 'orange', 'red', 'gently-pink', 'purple', 'violet', 'lightblue', 'darkblue'];
                            let index = 0;
                            let opacity = 1;
                            let increasing = false;
                            const smallBlackShadow = '0.5px 0.5px 0.5px black';
                            window.rainbowInterval = setInterval(() => {
                                if (increasing) {
                                    opacity += 0.05;
                                    if (opacity >= 1) {
                                        opacity = 1;
                                        increasing = false;
                                    }
                                } else {
                                    opacity -= 0.05;
                                    if (opacity <= 0.3) {
                                        opacity = 0.3;
                                        increasing = true;
                                        index = (index + 1) % colors.length;
                                    }
                                }
                                const currentGlow = glowColors[colors[index]];
                                const adjustedGlow = currentGlow.map(shadow => {
                                    const colorMatch = shadow.match(/(#[0-9a-fA-F]{6}|rgb\([^)]+\))/);
                                    if (colorMatch) {
                                        const color = colorMatch[1];
                                        const rgbColor = color.startsWith('#') ? 
                                            `rgb(${parseInt(color.slice(1,3), 16)}, ${parseInt(color.slice(3,5), 16)}, ${parseInt(color.slice(5,7), 16)})` : 
                                            color;
                                        return shadow.replace(colorMatch[1], `${rgbColor.replace('rgb', 'rgba').replace(')', `, ${opacity})`)}`);
                                    }
                                    return shadow;
                                });
                                // preview.style.textShadow = adjustedGlow.join(', ');
                                preview.style.textShadow = [smallBlackShadow, ...adjustedGlow].join(', ');
                            }, 50);
                            preview.style.color = 'white';
                        } else if (state.selectedColor === 'lightblue') {
                            // Особый случай для lightblue: ярче цвет и больше тень
                            preview.style.textShadow = [
                                '0.5px 0.5px 0.5px black',
                                ...Array.from({ length: 14 }, (_, i) => `#33e6ff 0px 0px ${i * 2 + 2}px`)
                            ].join(', ');
                            preview.style.color = 'white';
                        } else if (state.selectedColor === 'gently-pink') {
                            preview.style.textShadow = [
                                '0.5px 0.5px 0.5px black',
                                ...Array.from({ length: 14 }, (_, i) => `#ffb3e6 0px 0px ${i * 2 + 2}px`)
                            ].join(', ');
                            preview.style.color = 'white';

                        } else if (state.selectedColor === 'violet') {
                            preview.style.textShadow = [
                                '0.5px 0.5px 0.5px black',
                                ...Array.from({ length: 14 }, (_, i) => `#ff008a 0px 0px ${i * 2 + 2}px`)
                            ].join(', ');
                            preview.style.color = 'white';
                        } else {
                            preview.style.textShadow = getGlowShadow(state.selectedColor);
                            preview.style.color = 'white';
                        }
                    } else {
                        if (window.rainbowInterval) {
                            clearInterval(window.rainbowInterval);
                            window.rainbowInterval = null;
                        }
                        // Выключено — тени нет
                        preview.style.textShadow = 'none';
                        // Цвет текста = выбранный цвет
                        if (state.selectedColor === 'selected') {
                            preview.style.color = 'white';
                        } else if (state.selectedColor === 'lightblue') {
                            preview.style.color = 'white';
                        } else {
                            // Получаем цвет из glowColors (берём первый цвет из массива)
                            const firstShadow = glowColors[state.selectedColor]?.[0];
                            let color = 'white';
                            if (firstShadow) {
                                const colorMatch = firstShadow.match(/(#[0-9a-fA-F]{6}|rgb\([^)]+\))/);
                                if (colorMatch) color = colorMatch[1];
                            }
                            preview.style.color = color;
                        }
                    }
                }

                // Обработчик тоггла
                toggle.classList.add('active');
                toggle.addEventListener('click', () => {
                    state.glowEnabled = !state.glowEnabled;
                    toggle.classList.toggle('active', state.glowEnabled);
                    applyGlow();
                });

                // Обработчик выбора цвета
                colorOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        colorOptions.forEach(el => el.classList.remove('color-selected'));
                        option.classList.add('color-selected');
                        state.selectedColor = option.dataset.color;
                        selectedColorInput.value = state.selectedColor;
                        selectedColorLabel.textContent = colorLabelsParent[state.selectedColor] || state.selectedColor;
                        applyGlow();
                    });
                });
                
                const hiddenInputPreviewText = document.querySelector('input[type="hidden"][name="Текст"]');
                
                // Текст в превью
                textarea.addEventListener('input', function () {
                    let value = textarea.value || 'Ваш текст';
                    let lines = [];
                    for (let i = 0; i < value.length; i += 24) {
                        lines.push(value.slice(i, i + 24));
                    }
                    preview.innerHTML = lines.join('<br>');
                    if (hiddenInputPreviewText) {
                        hiddenInputPreviewText.value = value;
                    }
                    updateFontSize();
                });

                // Переход на следующую строку при нажатии Enter
                textarea.addEventListener('input', function () {
                    const value = this.value;
                    const withBreaks = value.replace(/\n/g, '<br>');
                    preview.innerHTML = withBreaks;
                });

                // Динамический размер шрифта
                function updateFontSize() {
                    const textLength = textarea.value.length;
                    const width = parseFloat(document.getElementById('size-signboard').value) || 90;
                    const minFontSize = 18;
                    const maxFontSize = 64;
                    const minWidth = 30;
                    const maxWidth = 300;
                    const maxChars = 10;
                    const minChars = 30;
                    let widthFontSize = minFontSize + (maxFontSize - minFontSize) * ((width - minWidth) / (maxWidth - minWidth));
                    let fontSize;
                    if (textLength <= maxChars) {
                        fontSize = widthFontSize;
                    } else if (textLength >= minChars) {
                        fontSize = widthFontSize * 0.6;
                    } else {
                        const percent = 1 - ((textLength - maxChars) / (minChars - maxChars)) * 0.4;
                        fontSize = widthFontSize * percent;
                    }
                    fontSize = Math.max(fontSize, minFontSize);
                    preview.style.fontSize = fontSize + 'px';
                }
                document.getElementById('size-signboard').addEventListener('input', updateFontSize);
                updateFontSize();

                // Инициализация текста и шрифта
                preview.textContent = textarea.value || 'neonroom.com';
                const initialFont = selectDisplay.getAttribute('data-value');
                if (initialFont) {
                    preview.classList.add(initialFont);
                }
                // Применить начальное свечение
                applyGlow();
            }

            // ПРАВЫЙ БЛОК НАЧАЛО
           
            const toggleDayNight = document.getElementById('toggle-2');
                toggleDayNight.addEventListener('click', () => {
                toggleDayNight.classList.toggle('active');
                updateBackgroundByToggle(); 
            });

            // Кнопки выбора фона
            const rightBlock = document.getElementById('right-block');
            const bgButtons = document.querySelectorAll('.bg-button');

            rightBlock.style.backgroundImage = `url('${bgButtons[0].dataset.nightBg}')`;

            bgButtons.forEach(btn => btn.addEventListener('click', () => {
                bgButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                updateBackgroundByToggle();
            }));

            updateBackgroundByToggle();

            function updateBackgroundByToggle() {
                const isDay = toggleDayNight.classList.contains('active');
                const activeBtn = document.querySelector('.bg-button.active');
                if (!activeBtn) return;

                const dayBg = activeBtn.dataset.dayBg;
                const nightBg = activeBtn.dataset.nightBg;
                const isFirst = [...bgButtons].indexOf(activeBtn) === 0;

                
                if (!isDay && isFirst) {
                    rightBlock.style.background = `url('${nightBg}')`;
                    rightBlock.style.backgroundSize = 'cover';
                    rightBlock.style.backgroundPosition = 'center';
                } else {
                    rightBlock.style.background = `url('${isDay ? dayBg : nightBg}')`;
                    rightBlock.style.backgroundSize = 'cover';
                    rightBlock.style.backgroundPosition = 'center';
                }
            }


            function updateMeasureLine() {
                const preview = document.getElementById('preview');
                const horizontalLine = document.querySelector('.horizontal-line');

                // Получаем ширину текста
                const previewWidth = preview.offsetWidth;
                // Устанавливаем такую же ширину для линии
                horizontalLine.style.width = `${previewWidth}px`;
            }
            const previewElement = document.getElementById('preview')
            const resizeObserver = new ResizeObserver(updateMeasureLine);
            resizeObserver.observe(previewElement)


            // ОБРАБОТКА СМЕНЫ ДНЯ И НОЧИ
            
            // ПРАВЫЙ БЛОК КОНЕЦ

            initFontDropdown()
            initColorPicker();
            
            
            document.addEventListener('DOMContentLoaded', () => {
                updateBackgroundByToggle();
                initSignboardPreview()
                updateMeasureLine()
                initColorBar();
            });

            

            document.addEventListener('DOMContentLoaded', function () {
                const outdoor = document.getElementById('outdoor-checkbox');
                const indoor = document.getElementById('indoor-checkbox');
                const remoteControl = document.getElementById('remote-control-checkbox');

                const hiddenLocationInput = document.querySelector('input[type="hidden"][name="Тип вывески"]'); 
                const hiddenRemoteInput = document.querySelector('input[type="hidden"][name="Пульт дистанционного управления"]'); 

                function updateSignType() {
                    if (outdoor.checked) {
                        indoor.checked = false;
                        hiddenLocationInput.value = 'Уличная';
                        c
                    } else if (indoor.checked) {
                        outdoor.checked = false;
                        hiddenLocationInput.value = 'Интерьерная';
                    } else {
                        hiddenLocationInput.value = '';
                    }
                }

                function updateRemoteControl() {
                    hiddenRemoteInput.value = remoteControl.checked ? 'Да' : 'Нет';
                }

                outdoor.addEventListener('change', updateSignType);
                indoor.addEventListener('change', updateSignType);
                remoteControl.addEventListener('change', updateRemoteControl);

                
                updateSignType();
                updateRemoteControl();

                
                
            });

            
           

            
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const alignButtons = document.querySelectorAll('.align-btn');
                const preview = document.getElementById('preview');
                const hiddenAllignInput = document.querySelector('input[type="hidden"][name="Расположение текста"]'); 
                
                let currentAlign = 'center';
                function setAlign(align) {
                    preview.style.textAlign = align;
                    hiddenAllignInput.value = align;
                    alignButtons.forEach(btn => {
                        if (btn.dataset.align === align) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                    currentAlign = align;
                    if (hiddenAlignInput) hiddenAlignInput.value = currentAlign;
                }
                alignButtons.forEach(btn => {
                    btn.addEventListener('click', function () {
                        setAlign(btn.dataset.align);
                        if (hiddenAlignInput) hiddenAlignInput.value = btn.dataset.align;
                    });
                });
                setAlign('center');
            });
        </script>
    </body>
</html>
